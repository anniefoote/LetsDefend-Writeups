# Writeup: SOC235 - Atlassian Confluence Broken Access Control 0-Day CVE-2023-22515

## Basic Info
**Category:** Security Analyst\
**Rating:** High\
**Type:** Web Attack\
**Event ID:** 197
<img width="1361" alt="Screenshot 2023-11-29 at 1 25 27 PM" src="https://github.com/anniefoote/LetsDefend-Writeups/assets/84354375/8b737a80-a684-4172-b103-41cef76ee51f">

## Playbook

### Understand Why the Alert Was Triggered
The alert appears to have been triggered as a result of broken access control being detected, specifically activity relating to the CVE-2023-22515 Confluence vulnerability.
The request is originating from an external IP - 43.130.1.222 with a destination inside the network at 172.16.17.234.
#### Playbook Action: None

### Collect Data
Traffic source: External IP - 43.130.1.222

Analysis of the source IP in VirusTotal shows it is located in the US and has been flagged as malicious.
<img width="1480" alt="Screenshot 2023-11-29 at 2 05 34 PM" src="https://github.com/anniefoote/LetsDefend-Writeups/assets/84354375/e3cf1af0-6d4b-43a5-9424-90103caeac42">

#### Playbook Action: None

### Examine HTTP Traffic
Logs show three requests made from the source IP in the alert all with the same destination address of 172.16.17.234. The requests all use HTTP on port 80 and are all sent by the same curl/7.88.1 user agent.
<img width="1777" alt="Screenshot 2023-11-29 at 2 17 14 PM" src="https://github.com/anniefoote/LetsDefend-Writeups/assets/84354375/34059c98-f886-4367-9be5-c2c936f613a8">

The first packet is a GET request with the URL `/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false`. The request has a response code of 200 indicating the request had no issues. This means that the server has successfully put itself in a state where setup in incomplete.  

The second packet is a POST request with the URL `/setup/setupadministrator.action`. The request had a response code of 302. 

The third packet is another POST request with the URL `/setup/finishsetup.action` and response code of 200.

These three URLs are the same as those documented for exploiting CVE-2023-22515.

#### Playbook Action: None

### Is the Traffic Malicious
The traffic is malicious as it requests the same URLs as those documented in exploit information for CVE-2023-22515.
#### Playbook Action: Is traffic malicious? Yes (Malicious)

### Attack Type
Documentation for CVE-2023-22515 categorises the vulnerability as broken access control. As the attack observed in the logs is an exploitation of CVE-2023-22515 it is also classed as broken access control.

#### Playbook Action: What is the attack type? Other (Broken Access Control)

### Planned Test
Reviewing email logs to find a scheduled testing notification around the time of the incident using IP 43.130.1.222 produced no results. Based on this the activity does not appear to be part of a planned test.
<img width="1658" alt="Screenshot 2023-11-30 at 10 49 07 AM" src="https://github.com/anniefoote/LetsDefend-Writeups/assets/84354375/eabaf429-6998-497c-82f0-eedac369c6da">
#### Playbook Action: Is the malicious traffic caused by a planned test? No (Not Planned)

### Traffic Direction
The IP making the requests is 43.130.1.222, this is an external IP located outside of the company network. The requests are being made to the device at IP 172.16.17.234 located inside the company network.
Searching this IP inside endpoint security shows the IP belongs to the company's confluence server.
<img width="604" alt="Screenshot 2023-11-30 at 10 52 06 AM" src="https://github.com/anniefoote/LetsDefend-Writeups/assets/84354375/ee8e9a39-205f-41ae-9ffd-8f740f917c60">

#### Playbook Action: What is the direction of traffic? Internet -> Company Network

### Check Whether the Attack was Successful
The final packet had a response code of 200 indicating the request went through successfully. The 200 response code for this request condusive with the documentation for successful exploits of CVE-2023-22515, indicating the attack was successful.
<img width="1369" alt="Screenshot 2023-11-30 at 10 58 37 AM" src="https://github.com/anniefoote/LetsDefend-Writeups/assets/84354375/53ebc06d-be02-4f2c-8545-86b6ffa7dc29">

#### Playbook Action: Was the attack successful? Yes

### Containment
As the attack was successful the affected device needs to be contained to prevent further spread of the attack and to reduce further impact.
<img width="1209" alt="Screenshot 2023-11-30 at 11 02 43 AM" src="https://github.com/anniefoote/LetsDefend-Writeups/assets/84354375/2c205617-9426-4aa5-a0ca-d36964e0e117">
#### Playbook Action: Contain affected endpoint

### Tier 2 Escalation
As the attack was successful, tier 2 escalation will be required.
#### Playbook Action: Perform tier 2 escalation? Yes
